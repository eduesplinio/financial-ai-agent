import { z } from 'zod';
import { TransactionCreateSchema } from '@financial-ai-agent/database/src/models';

/**
 * Pipeline de pré-processamento de texto para descrições de transações.
 * - Limpeza de texto
 * - Normalização
 * - Remoção de stopwords
 * - Tokenização
 * - Stemming (opcional)
 */

// Lista de stopwords em português (exemplo simplificado)
const STOPWORDS = [
  'de',
  'do',
  'da',
  'em',
  'para',
  'com',
  'sem',
  'por',
  'a',
  'o',
  'e',
  'é',
  'na',
  'no',
  'as',
  'os',
  'um',
  'uma',
  'uns',
  'umas',
  'que',
  'se',
  'ao',
  'dos',
  'das',
  'ou',
  'mas',
  'como',
  'já',
  'foi',
  'ser',
  'tem',
  'há',
  'até',
  'após',
  'sobre',
  'entre',
  'também',
  'mais',
  'menos',
  'muito',
  'pouco',
  'quando',
  'onde',
  'qual',
  'quais',
  'quem',
  'cujo',
  'cujos',
  'cuja',
  'cujas',
  'esse',
  'essa',
  'esses',
  'essas',
  'aquele',
  'aquela',
  'aqueles',
  'aquelas',
  'isto',
  'isso',
  'aquilo',
  'deste',
  'desta',
  'desses',
  'dessas',
  'daquele',
  'daquela',
  'daqueles',
  'daquelas',
  'neste',
  'nesta',
  'nesses',
  'nessas',
  'naquele',
  'naquela',
  'naqueles',
  'naquelas',
  'me',
  'te',
  'se',
  'lhe',
  'nos',
  'vos',
  'lhes',
  'meu',
  'minha',
  'meus',
  'minhas',
  'teu',
  'tua',
  'teus',
  'tuas',
  'seu',
  'sua',
  'seus',
  'suas',
  'nosso',
  'nossa',
  'nossos',
  'nossas',
  'vosso',
  'vossa',
  'vossos',
  'vossas',
  'dele',
  'dela',
  'deles',
  'delas',
  'este',
  'esta',
  'estes',
  'estas',
  'esse',
  'essa',
  'esses',
  'essas',
  'aquele',
  'aquela',
  'aqueles',
  'aquelas',
  'isto',
  'isso',
  'aquilo',
  'estou',
  'está',
  'estamos',
  'estão',
  'estive',
  'esteve',
  'estivemos',
  'estiveram',
  'estava',
  'estávamos',
  'estavam',
  'estivera',
  'estivéramos',
  'esteja',
  'estejamos',
  'estejam',
  'estivesse',
  'estivéssemos',
  'estivessem',
  'estiver',
  'estivermos',
  'estiverem',
  'hei',
  'há',
  'havemos',
  'hão',
  'houve',
  'houvemos',
  'houveram',
  'houvera',
  'houvéramos',
  'haja',
  'hajamos',
  'hajam',
  'houvesse',
  'houvéssemos',
  'houvessem',
  'houver',
  'houvermos',
  'houverem',
  'houverei',
  'houverá',
  'houveremos',
  'houverão',
  'houveria',
  'houveríamos',
  'houveriam',
  'sou',
  'somos',
  'são',
  'era',
  'éramos',
  'eram',
  'fui',
  'foi',
  'fomos',
  'foram',
  'fora',
  'fôramos',
  'seja',
  'sejamos',
  'sejam',
  'fosse',
  'fôssemos',
  'fossem',
  'for',
  'formos',
  'forem',
  'serei',
  'será',
  'seremos',
  'serão',
  'seria',
  'seríamos',
  'seriam',
  'tenho',
  'tem',
  'temos',
  'têm',
  'tinha',
  'tínhamos',
  'tinham',
  'tive',
  'teve',
  'tivemos',
  'tiveram',
  'tivera',
  'tivéramos',
  'tenha',
  'tenhamos',
  'tenham',
  'tivesse',
  'tivéssemos',
  'tivessem',
  'tiver',
  'tivermos',
  'tiverem',
  'terei',
  'terá',
  'teremos',
  'terão',
  'teria',
  'teríamos',
  'teriam',
];

export function preprocessDescription(description: string): string[] {
  // Limpeza: remove pontuação, números, converte para minúsculas
  let text = description
    .toLowerCase()
    .replace(/[0-9]/g, '')
    .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '')
    .replace(/\s{2,}/g, ' ');

  // Tokenização
  let tokens = text.split(' ');

  // Remoção de stopwords
  tokens = tokens.filter(token => token && !STOPWORDS.includes(token));

  // Stemming (opcional, pode ser adicionado com biblioteca)
  // Exemplo: usar 'natural' ou 'snowball-stemmer' para português

  return tokens;
}

// Exemplo de uso:
// const tokens = preprocessDescription('Pagamento de boleto bancário no Itaú');
// console.log(tokens); // ['pagamento', 'boleto', 'bancário', 'itaú']
